{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html lang="{% get_current_language as LANGUAGE_CODE %}{{ LANGUAGE_CODE }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vassta Yacht Cybersecurity</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="scanlines"></div>
    <div class="bg-grid"></div>
    <header class="header">
        <div class="container header__container">
            <div class="header__logo">VASSTA::COM</div>
            <nav class="header__nav">
                <a href="#" id="nav-expertise-link" class="nav-link-expertise">{% trans "–≠–∫—Å–ø–µ—Ä—Ç–∏–∑–∞" %}</a>
                <a href="#services" class="nav-link-desktop">{% trans "–£—Å–ª—É–≥–∏" %}</a>
                <a href="#process" class="nav-link-desktop">{% trans "–ü—Ä–æ—Ü–µ—Å—Å" %}</a>
                <a href="#contact" class="header__cta">{% trans "–°–≤—è–∑–∞—Ç—å—Å—è" %}</a>
                
                <div class="lang-switch-container">
                    <button class="lang-toggle" id="lang-toggle">
                        {{ LANGUAGE_CODE|upper }} <span class="arrow">‚ñº</span>
                    </button>
                    <div class="lang-switch" id="lang-switch-menu">
                        {% get_current_language as LANGUAGE_CODE %}
                        <a href="{{ lang_urls.en }}" class="{% if LANGUAGE_CODE == 'en' %}active{% endif %}">EN</a>
                        <a href="{{ lang_urls.el }}" class="{% if LANGUAGE_CODE == 'el' %}active{% endif %}">EL</a>
                        <a href="{{ lang_urls.ru }}" class="{% if LANGUAGE_CODE == 'ru' %}active{% endif %}">RU</a>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <main>
        <section class="hero">
            <div class="container">
                                <div class="hero__content">
                    <div class="hero__badge">{% trans "Since 2004" %}</div>
                    <h1>{% trans "–ö–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ø—Ö—Ç: –ó–∞—â–∏—Ç–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ VIP-–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏" %}</h1>
                    <p>{% trans "–û—Ç —Ç—Ä–∏—Ä–µ–º –¥–æ –º–µ–≥–∞—è—Ö—Ç: –≠–≤–æ–ª—é—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞ –º–æ—Ä–µ." %}</p>
                    <div class="hero__actions">
                        <a class="btn btn--primary" href="#contact">{% trans "–ó–∞–ø—Ä–æ—Å–∏—Ç—å –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –ê—É–¥–∏—Ç" %}</a>
                        <a class="btn btn--secondary" href="#expertise">{% trans "–ü–æ—á–µ–º—É –º—ã" %}</a>
                    </div>
                </div>
            </div>
        </section>

        <section class="why" id="why">
            <div class="container">
                <h2>{% trans "–í–∞—à–∞ –Ø—Ö—Ç–∞ ‚Äî –≠—Ç–æ –û–±—ä–µ–∫—Ç –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã" %}</h2>
                <p style="text-align: center; max-width: 700px; margin: 0 auto 3rem; color: var(--text-secondary);">
                    {% trans "–û–±—ã—á–Ω–∞—è IT-–ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ Wi-Fi –∏ –ø—Ä–∏–Ω—Ç–µ—Ä–∞—Ö. –ú—ã —Ñ–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ —Ä–∏—Å–∫–∞—Ö, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ—Å—É—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ, —Ä–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –ø–æ—Ç–µ—Ä–∏." %}
                </p>
                <div class="grid grid--3">
                    <div class="card">
                        <h3>{% trans "‚öì –ù–∞—Ä—É—à–µ–Ω–∏–µ –ù–∞–≤–∏–≥–∞—Ü–∏–∏ (OT)" %}</h3>
                        <p>{% trans "–í–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ –≤ GPS, ECDIS –∏–ª–∏ –¥–≤–∏–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã. –†–∏—Å–∫ –ø–æ—Ç–µ—Ä–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—É–¥–Ω–æ–º –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫—É—Ä—Å–∞." %}</p>
                    </div>
                    <div class="card">
                        <h3>{% trans "üïµÔ∏è –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–π –®–ø–∏–æ–Ω–∞–∂" %}</h3>
                        <p>{% trans "–ü—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ –¥–µ–ª–æ–≤—ã—Ö –ø–µ—Ä–µ–≥–æ–≤–æ—Ä–æ–≤ –≤–ª–∞–¥–µ–ª—å—Ü–∞ —á–µ—Ä–µ–∑ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ç–∏ –∏ –Ω–µ–∑–∞—â–∏—â–µ–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã —Å–≤—è–∑–∏." %}</p>
                    </div>
                    <div class="card">
                        <h3>{% trans "üö® –ù–µ–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –∫–∏–±–µ—Ä–∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞–º" %}</h3>
                        <p>{% trans "–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —á–µ—Ç–∫–æ–≥–æ –ø–ª–∞–Ω–∞ –¥–µ–π—Å—Ç–≤–∏–π –ø—Ä–∏ –∞—Ç–∞–∫–µ ‚Äî —á—Ç–æ –¥–µ–ª–∞—Ç—å, –∫–æ–≥–¥–∞ –≤–∑–ª–æ–º–∞–ª–∏ Starlink –∏–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ —Å–µ—Ç—å." %}</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="expertise" id="expertise" style="padding: 6rem 0; position: relative; overflow: hidden;">
            <!-- Decorative AI element -->
            <div class="ai-glow" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 600px; height: 600px; background: radial-gradient(circle, rgba(77, 225, 215, 0.1) 0%, transparent 70%); pointer-events: none; z-index: 0;"></div>
            
            <div class="container" style="position: relative; z-index: 1;">
                <div style="max-width: 800px; margin: 0 auto; text-align: center;">
                    <h2>{% trans "–°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –ó–∞—â–∏—Ç—ã –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã" %}</h2>
                    <p style="font-size: 1.1rem; margin-bottom: 3rem; color: var(--text-secondary);">
                        {% trans "–ù–∞—à–∞ —ç–∫—Å–ø–µ—Ä—Ç–∏–∑–∞, –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–∞—è —Å 2004 –≥–æ–¥–∞, –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–µ—Å–ø–µ—á–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏, –ø—Ä–∏–º–µ–Ω—è–µ–º—ã–π –Ω–∞ –æ–±—ä–µ–∫—Ç–∞—Ö –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π –æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–º —Å–µ–∫—Ç–æ—Ä–µ –≤—ã—Å—à–µ–≥–æ —É—Ä–æ–≤–Ω—è." %}
                    </p>
                </div>
                <div class="grid grid--3">
                    {% for standard in standards %}
                    <div class="service-item">
                        <h3>{{ standard.title }}</h3>
                        <p>{{ standard.description }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </section>

        <!-- Mobile Expertise Section (Hidden on Desktop) -->
        <section id="mobile-expertise-section" class="mobile-expertise-section mobile-only">
            <div class="container">
                <h2>{% trans "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –≠–∫—Å–ø–µ—Ä—Ç–∏–∑–∞" %}</h2>
                
                <!-- Horizontal Scroll Tabs -->
                <div class="mobile-tabs-container">
                    <div class="mobile-tabs-scroll">
                        {% for card in expertise_cards %}
                        <button class="mobile-tab-btn {% if forloop.first %}active{% endif %}" data-target="mob-card-{{ card.id }}">
                            {{ card.title }}
                        </button>
                        {% endfor %}
                    </div>
                </div>

                <!-- Content Area -->
                <div class="mobile-content-area">
                    {% for card in expertise_cards %}
                    <div id="mob-card-{{ card.id }}" class="mobile-card-content {% if forloop.first %}active{% endif %}">
                        {% if card.image %}
                        <img src="{{ card.image.url }}" alt="{{ card.title }}" class="mobile-card-image">
                        {% endif %}
                        <div class="mobile-card-body">
                            <h3>{{ card.title }}</h3>
                            <div class="mobile-card-text">
                                {{ card.full_content|safe }}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </section>

        <section class="services" id="services">
            <div class="container">
                <h2>{% trans "–ú–µ–Ω—é –£—Å–ª—É–≥" %}</h2>
                <div class="grid grid--2">
                    {% for service in services %}
                    <div class="service-item" onclick="expandCard(this)">
                        <div class="close-btn" onclick="event.stopPropagation(); closeCard(this.parentNode)">√ó</div>
                        <h3>{{ service.title }}</h3>
                        <p>{{ service.description }}</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </section>

        <section class="process" id="process" style="padding: 6rem 0; text-align: center;">
            <div class="container">
                <h2>{% trans "–ö–∞–∫ –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É" %}</h2>
                <div class="grid grid--3" style="margin-top: 3rem;">
                    <div class="card" style="border: 1px solid var(--accent-dark);">
                        <div style="font-size: 2rem; color: var(--accent); margin-bottom: 1rem;">1</div>
                        <h3>{% trans "–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –ó–∞–ø—Ä–æ—Å" %}</h3>
                        <p>{% trans "–í—ã —Å–≤—è–∑—ã–≤–∞–µ—Ç–µ—Å—å —Å –Ω–∞—à–∏–º –ì–ª–∞–≤–Ω—ã–º –≠–∫—Å–ø–µ—Ä—Ç–æ–º –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è –∑–∞–¥–∞—á–∏." %}</p>
                    </div>
                    <div class="card" style="border: 1px solid var(--accent-dark);">
                        <div style="font-size: 2rem; color: var(--accent); margin-bottom: 1rem;">2</div>
                        <h3>{% trans "Gap Analysis (–ü—Ä–µ–¥–∞—É–¥–∏—Ç)" %}</h3>
                        <p>{% trans "–ú—ã –ø—Ä–æ–≤–æ–¥–∏–º —ç–∫—Å–ø—Ä–µ—Å—Å-–∞–Ω–∞–ª–∏–∑ –í–∞—à–∏—Ö —Å–∏—Å—Ç–µ–º –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –ö–ò–ò –∏ IACS." %}</p>
                    </div>
                    <div class="card" style="border: 1px solid var(--accent-dark);">
                        <div style="font-size: 2rem; color: var(--accent); margin-bottom: 1rem;">3</div>
                        <h3>{% trans "–¶–µ–ª–µ–≤–æ–π –ü–ª–∞–Ω" %}</h3>
                        <p>{% trans "–ú—ã –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º –û—Ç—á–µ—Ç —Å —Ç–æ—á–Ω—ã–º —Å–ø–∏—Å–∫–æ–º –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–∞–∑—Ä—ã–≤–æ–≤ –∏ –ø–ª–∞–Ω–æ–º –∏—Ö —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è." %}</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="contact" id="contact" style="padding: 6rem 0; background: rgba(255,255,255,0.02);">
            <div class="container" style="text-align: center; max-width: 600px;">
                <h2>{% trans "–°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏" %}</h2>
                <p style="margin-bottom: 2rem;">{% trans "–ì–æ—Ç–æ–≤—ã –æ–±—Å—É–¥–∏—Ç—å –∑–∞—â–∏—Ç—É –≤–∞—à–µ–π —è—Ö—Ç—ã? –ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –¥–ª—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏." %}</p>
                <a href="mailto:info@vassta.com" class="btn btn--primary" style="font-size: 1.2rem; padding: 1rem 2.5rem;">info@vassta.com</a>
                <p style="margin-top: 2rem; font-size: 0.9rem; color: var(--text-secondary);">
                    {% trans "–í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ–º —Å—Ç—Ä–æ–∂–∞–π—à–µ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏." %}
                </p>
            </div>
        </section>
    </main>

    <footer style="padding: 2rem 0; text-align: center; border-top: 1px solid rgba(255,255,255,0.05); margin-top: 4rem;">
        <div class="container">
            <p>
                &copy; 2025 Vassta Yacht Cybersecurity. {% trans "All rights reserved." %}
                <br>
                <a href="{% url 'pages:legal_document' slug='privacy-policy' %}" target="_blank" style="color: var(--text-secondary); text-decoration: none; font-size: 0.9rem; margin-top: 0.5rem; display: inline-block;">{% translate "Privacy Policy" context "footer" %}</a>
            </p>
        </div>
    </footer>

    <!-- Expertise Modal -->
    <div class="modal-overlay" id="expertise-modal">
        <div class="modal-content">
            <button class="modal-close" id="close-expertise-modal">&times;</button>
            <div class="modal-header">
                <h2>{% trans "–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –≠–∫—Å–ø–µ—Ä—Ç–∏–∑–∞" %}</h2>
            </div>
            
            <div class="gallery-container" id="gallery-view">
                {% for card in expertise_cards %}
                <div class="gallery-card" data-target="detail-{{ card.id }}" style="cursor: pointer;">
                    {% if card.image %}
                    <img src="{{ card.image.url }}" alt="{{ card.title }}">
                    {% endif %}
                    <h3>{{ card.title }}</h3>
                    <p>{{ card.short_description }}</p>
                </div>
                {% endfor %}
            </div>

            <div class="detail-container" id="detail-view" style="display: none; opacity: 0;">
                <button class="btn-back" id="back-to-gallery">‚Üê {% trans "–ù–∞–∑–∞–¥" %}</button>
                <div id="detail-content-placeholder"></div>
            </div>

            <!-- Hidden content for details -->
            <div style="display: none;">
                {% for card in expertise_cards %}
                <div id="detail-{{ card.id }}">
                    {% if card.image %}
                    <img src="{{ card.image.url }}" alt="{{ card.title }}" style="width: 100%; height: 300px; object-fit: cover; margin-bottom: 2rem; border: 1px solid var(--accent-primary);">
                    {% endif %}
                    <h3 style="color: var(--accent-primary); font-size: 2rem; margin-bottom: 1rem;">{{ card.title }}</h3>
                    <div class="detail-body" style="color: var(--text-secondary); line-height: 1.6;">
                        {{ card.full_content|safe }}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- Elements ---
            const modal = document.getElementById('expertise-modal');
            const navExpertiseLink = document.getElementById('nav-expertise-link');
            const closeBtn = document.getElementById('close-expertise-modal');
            const galleryView = document.getElementById('gallery-view');
            const detailView = document.getElementById('detail-view');
            const backBtn = document.getElementById('back-to-gallery');
            const detailPlaceholder = document.getElementById('detail-content-placeholder');

            // Mobile Elements
            const langToggle = document.getElementById('lang-toggle');
            const langMenu = document.getElementById('lang-switch-menu');
            const mobileTabs = document.querySelectorAll('.mobile-tab-btn');
            const mobileContents = document.querySelectorAll('.mobile-card-content');

            // --- Mobile Logic ---

            // Language Switcher Toggle
            if (langToggle && langMenu) {
                langToggle.addEventListener('click', function(e) {
                    e.stopPropagation();
                    langMenu.classList.toggle('active');
                    langToggle.classList.toggle('active');
                });

                document.addEventListener('click', function(e) {
                    if (!langToggle.contains(e.target) && !langMenu.contains(e.target)) {
                        langMenu.classList.remove('active');
                        langToggle.classList.remove('active');
                    }
                });
            }

            // Expertise Link Handler
            if (navExpertiseLink) {
                navExpertiseLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (window.innerWidth <= 768) {
                        // Mobile: Scroll to section
                        const mobileSection = document.getElementById('mobile-expertise-section');
                        if (mobileSection) {
                            const headerOffset = 100; // Adjust for fixed header
                            const elementPosition = mobileSection.getBoundingClientRect().top;
                            const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                            
                            window.scrollTo({
                                top: offsetPosition,
                                behavior: "smooth"
                            });
                        }
                    } else {
                        // Desktop: Open Modal
                        if (modal) {
                            modal.classList.add('active');
                            document.body.style.overflow = 'hidden';
                            resetView();
                        }
                    }
                });
            }

            // Mobile Tabs Logic
            mobileTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    mobileTabs.forEach(t => t.classList.remove('active'));
                    // Add active class to clicked tab
                    this.classList.add('active');

                    // Hide all contents
                    mobileContents.forEach(c => c.classList.remove('active'));
                    
                    // Show target content
                    const targetId = this.getAttribute('data-target');
                    const targetContent = document.getElementById(targetId);
                    if (targetContent) {
                        targetContent.classList.add('active');
                    }
                });
            });

            // --- Desktop Modal Logic ---

            // Close Modal
            if (closeBtn) {
                closeBtn.addEventListener('click', closeModal);
            }

            if (modal) {
                modal.addEventListener('click', function(e) {
                    if (e.target === modal) {
                        closeModal();
                    }
                });
            }
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modal && modal.classList.contains('active')) {
                    closeModal();
                }
            });

            function closeModal() {
                if (modal) {
                    modal.classList.remove('active');
                    document.body.style.overflow = '';
                    setTimeout(resetView, 300);
                }
            }

            function resetView() {
                if (galleryView && detailView) {
                    galleryView.style.display = 'flex';
                    setTimeout(() => {
                        galleryView.classList.remove('fade-out');
                    }, 10);
                    detailView.style.display = 'none';
                    detailView.classList.remove('active');
                    if (detailPlaceholder) detailPlaceholder.innerHTML = '';
                }
            }

            // Card Click (Desktop Gallery)
            const cards = document.querySelectorAll('.gallery-card');
            cards.forEach(card => {
                card.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    // Note: The content is inside the hidden div in the modal, but we can also grab it from the mobile content if needed, 
                    // but the original logic used a hidden div. Let's check if that hidden div still exists.
                    // It does, I didn't remove it.
                    const contentElement = document.getElementById(targetId); // This targets the hidden div inside modal-content
                    
                    // Wait, the mobile content uses IDs like "mob-card-{{ card.id }}".
                    // The desktop modal uses "detail-{{ card.id }}".
                    // So we are safe.
                    
                    if (contentElement && galleryView && detailView) {
                        const content = contentElement.innerHTML;
                        
                        galleryView.classList.add('fade-out');
                        
                        setTimeout(() => {
                            galleryView.style.display = 'none';
                            detailView.style.display = 'block';
                            if (detailPlaceholder) detailPlaceholder.innerHTML = content;
                            
                            // Trigger reflow
                            void detailView.offsetWidth;
                            
                            detailView.classList.add('active');
                        }, 500);
                    }
                });
            });

            // Back Button
            if (backBtn) {
                backBtn.addEventListener('click', function() {
                    if (detailView && galleryView) {
                        detailView.classList.remove('active');
                        
                        setTimeout(() => {
                            detailView.style.display = 'none';
                            galleryView.style.display = 'flex';
                            
                            // Trigger reflow
                            void galleryView.offsetWidth;
                            
                            galleryView.classList.remove('fade-out');
                        }, 500);
                    }
                });
            }
        });
    </script>
    <div id="overlay" class="overlay" onclick="closeAllCards()"></div>

    <!-- Cookie Banner -->
    <div id="cookie-banner" class="cookie-banner">
        <div class="cookie-banner__content">
            <div class="cookie-banner__text">
                {% trans "We use cookies to improve the site's performance and analyze traffic. By continuing to use the site, you agree to our" %} <a href="#">{% trans "Privacy Policy" %}</a>.
            </div>
            <div class="cookie-banner__actions">
                <button class="btn btn--primary" onclick="acceptCookies()">{% trans "Accept" %}</button>
            </div>
        </div>
    </div>

    <!-- Language Suggestion Toast -->
    <div id="lang-toast" class="lang-toast">
        <div class="lang-toast__content">
            <span>Select Language / –í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫:</span>
            <div class="lang-toast__buttons">
                <button onclick="selectLanguage('{{ lang_urls.en }}')">EN</button>
                <button onclick="selectLanguage('{{ lang_urls.ru }}')">RU</button>
                <button onclick="selectLanguage('{{ lang_urls.el }}')">EL</button>
            </div>
            <button class="lang-toast__close" onclick="closeLangToast()">√ó</button>
        </div>
    </div>

    <script>
        // Cookie Logic
        function checkCookieConsent() {
            if (!localStorage.getItem('cookie_consent')) {
                document.getElementById('cookie-banner').style.display = 'block';
            }
        }

        function acceptCookies() {
            localStorage.setItem('cookie_consent', 'true');
            document.getElementById('cookie-banner').style.display = 'none';
        }

        // Language Selection Logic
        function checkLanguageSelection() {
            // Check if user has already selected a language
            if (!localStorage.getItem('language_selected')) {
                // Show toast instead of modal
                setTimeout(() => {
                    document.getElementById('lang-toast').style.display = 'block';
                }, 1000); // Small delay for better UX
            }
        }

        function selectLanguage(url) {
            // Set flag in localStorage
            localStorage.setItem('language_selected', 'true');
            // Redirect to the custom switch view
            window.location.href = url;
        }

        function closeLangToast() {
            document.getElementById('lang-toast').style.display = 'none';
            // Optionally set the flag so it doesn't show again this session?
            // Or maybe we want it to show until they pick one?
            // Let's set it to true to stop pestering them if they close it.
            localStorage.setItem('language_selected', 'true');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkCookieConsent();
            checkLanguageSelection();
        });

        function expandCard(card) {
            if (card.classList.contains('expanded')) return;
            
            const rect = card.getBoundingClientRect();
            
            // Create placeholder to prevent layout shift
            const placeholder = document.createElement('div');
            placeholder.style.width = rect.width + 'px';
            placeholder.style.height = rect.height + 'px';
            placeholder.className = 'card-placeholder';
            
            // Save original state
            card._originalParent = card.parentNode;
            card._originalNextSibling = card.nextSibling;
            card._originalStyles = {
                position: card.style.position,
                top: card.style.top,
                left: card.style.left,
                width: card.style.width,
                height: card.style.height,
                margin: card.style.margin,
                zIndex: card.style.zIndex
            };
            card._placeholder = placeholder;

            // Insert placeholder and move card to body
            card.parentNode.insertBefore(placeholder, card);
            document.body.appendChild(card);

            // Set initial position to match grid location
            card.style.position = 'fixed';
            card.style.top = rect.top + 'px';
            card.style.left = rect.left + 'px';
            card.style.width = rect.width + 'px';
            card.style.height = rect.height + 'px';
            card.style.margin = '0';
            card.style.zIndex = '1000';

            // Force reflow
            void card.offsetWidth;

            // Animate to center
            card.classList.add('expanded');
            document.getElementById('overlay').classList.add('active');
        }

        function closeCard(card) {
            card.classList.remove('expanded');
            document.getElementById('overlay').classList.remove('active');
            
            // Wait for transition to finish before moving back
            setTimeout(() => {
                if (card._placeholder && card._originalParent) {
                    // Restore original styles
                    const styles = card._originalStyles || {};
                    card.style.position = styles.position;
                    card.style.top = styles.top;
                    card.style.left = styles.left;
                    card.style.width = styles.width;
                    card.style.height = styles.height;
                    card.style.margin = styles.margin;
                    card.style.zIndex = styles.zIndex;

                    // Move back to grid
                    card._originalParent.insertBefore(card, card._originalNextSibling);
                    card._placeholder.remove();
                    
                    // Cleanup
                    card._placeholder = null;
                    card._originalParent = null;
                    card._originalNextSibling = null;
                    card._originalStyles = null;
                }
            }, 300);
        }

        function closeAllCards() {
            const expandedCard = document.querySelector('.service-item.expanded');
            if (expandedCard) {
                closeCard(expandedCard);
            }
        }
    </script>
</body>
</html>
